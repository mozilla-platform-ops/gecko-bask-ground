---
name: xpcshell (test-windows10-64)
on:
  push:
    branches:
      - main
jobs:
  debug-xpcshell-e10s-1:
    runs-on: windows-2019
    steps:
      - uses: actions/checkout@v2
      - name: mounts
        run: |
          curl -L https://hg.mozilla.org/try/raw-file/45c659bd4922fa3b4a7b602c6214f16092a31284/taskcluster/scripts/misc/fetch-content --output fetch-content
          curl -L https://hg.mozilla.org/try/raw-file/45c659bd4922fa3b4a7b602c6214f16092a31284/taskcluster/scripts/run-task --output run-task
          curl -L https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/VCHd7SmcQhWaQix7Gh4taQ/artifacts/public/build/mozharness.zip --output mozharness.zip
          7z x -omozharness mozharness.zip
      - name: dependencies
        run: |
          python -m pip install --upgrade zstandard
          python -m pip install --upgrade certifi
      - name: test
        env:
          TASKCLUSTER_ROOT_URL: https://firefox-ci-tc.services.mozilla.com
          PYTHON: C:\hostedtoolcache\windows\Python\3.7.9\x64\python.exe
          MOZ_FETCHES: "[{\"artifact\": \"public/build/fix-stacks.tar.bz2\", \"extract\": true, \"task\": \"Lhs91AvoT-28yyuTcna2Gw\"}, {\"artifact\": \"public/build/minidump_stackwalk.tar.xz\", \"extract\": true, \"task\": \"IGMuVbTvSiafcP8RW2xM-g\"}, {\"artifact\": \"public/build/node.tar.zst\", \"extract\": true, \"task\": \"Du1bGczPTLGc2XKvucvs1Q\"}]"
          MOZ_SCM_LEVEL: "3"
          GECKO_HEAD_REV: "45c659bd4922fa3b4a7b602c6214f16092a31284"
          MOZ_AUTOMATION: "1"
          MOZ_FETCHES_DIR: "fetches"
          SCCACHE_DISABLE: "1"
          GECKO_HEAD_REPOSITORY: "https://hg.mozilla.org/mozilla-central"
          MOZHARNESS_TEST_PATHS: "{\"xpcshell\": [\"browser/components/doh/test/unit/xpcshell.ini\", \"browser/components/enterprisepolicies/tests/xpcshell/xpcshell.ini\", \"browser/components/migration/tests/unit/xpcshell.ini\", \"browser/components/payments/test/unit/xpcshell.ini\", \"browser/components/places/tests/unit/xpcshell.ini\", \"browser/components/shell/test/unit/xpcshell.ini\", \"browser/components/urlbar/tests/unit/xpcshell.ini\", \"browser/tools/mozscreenshots/tests/xpcshell/xpcshell.ini\", \"caps/tests/unit/xpcshell.ini\", \"devtools/client/aboutdebugging/test/xpcshell/xpcshell.ini\", \"devtools/client/framework/test/xpcshell/xpcshell.ini\", \"devtools/client/performance/test/xpcshell/xpcshell.ini\", \"devtools/client/responsive/test/xpcshell/xpcshell.ini\", \"devtools/client/shared/redux/middleware/xpcshell/xpcshell.ini\", \"devtools/client/shared/remote-debugging/adb/xpcshell/xpcshell.ini\", \"devtools/client/shared/remote-debugging/test/xpcshell/xpcshell.ini\", \"devtools/client/shared/test/xpcshell/xpcshell.ini\", \"devtools/client/webconsole/test/xpcshell/xpcshell.ini\", \"devtools/platform/tests/xpcshell/xpcshell.ini\", \"devtools/server/actors/compatibility/lib/test/xpcshell/xpcshell.ini\", \"devtools/shared/heapsnapshot/tests/xpcshell/xpcshell.ini\", \"devtools/shared/performance/xpcshell/xpcshell.ini\", \"devtools/shared/qrcode/tests/xpcshell/xpcshell.ini\", \"devtools/shared/security/tests/xpcshell/xpcshell.ini\", \"devtools/shared/storage/vendor/stringvalidator/tests/xpcshell/xpcshell.ini\", \"devtools/shared/tests/xpcshell/xpcshell.ini\", \"devtools/shared/transport/tests/xpcshell/xpcshell.ini\", \"devtools/startup/tests/xpcshell/xpcshell.ini\", \"docshell/test/unit/xpcshell.ini\", \"docshell/test/unit_ipc/xpcshell.ini\", \"dom/base/test/unit_ipc/xpcshell.ini\", \"dom/cache/test/xpcshell/xpcshell.ini\", \"dom/console/tests/xpcshell/xpcshell.ini\", \"dom/encoding/test/unit/xpcshell.ini\", \"dom/indexedDB/test/unit/xpcshell-child-process.ini\", \"dom/indexedDB/test/unit/xpcshell-parent-process.ini\", \"dom/messagechannel/tests/unit/xpcshell.ini\", \"dom/promise/tests/unit/xpcshell.ini\", \"dom/quota/test/xpcshell/caching/xpcshell.ini\", \"dom/quota/test/xpcshell/telemetry/xpcshell.ini\", \"dom/security/test/unit/xpcshell.ini\", \"dom/tests/unit/xpcshell.ini\", \"extensions/pref/autoconfig/test/unit/xpcshell.ini\", \"extensions/spellcheck/hunspell/tests/unit/xpcshell.ini\", \"image/test/unit/xpcshell.ini\", \"intl/uconv/tests/unit/xpcshell.ini\", \"ipc/testshell/tests/xpcshell.ini\", \"layout/tools/layout-debug/tests/unit/xpcshell.ini\", \"modules/libjar/test/unit/xpcshell.ini\", \"modules/libpref/test/unit/xpcshell.ini\", \"netwerk/cookie/test/unit/xpcshell.ini\", \"netwerk/test/unit/xpcshell.ini\", \"remote/shared/test/xpcshell/xpcshell.ini\", \"security/manager/ssl/tests/unit/xpcshell-smartcards.ini\", \"services/common/tests/unit/xpcshell.ini\", \"services/sync/tests/unit/xpcshell.ini\", \"toolkit/components/antitracking/test/xpcshell/xpcshell.ini\", \"toolkit/components/asyncshutdown/tests/xpcshell/xpcshell.ini\", \"toolkit/components/autocomplete/tests/unit/xpcshell.ini\", \"toolkit/components/backgroundhangmonitor/tests/xpcshell.ini\", \"toolkit/components/captivedetect/test/unit/xpcshell.ini\", \"toolkit/components/cleardata/tests/unit/xpcshell.ini\", \"toolkit/components/commandlines/test/unit_unix/xpcshell.ini\", \"toolkit/components/commandlines/test/unit_win/xpcshell.ini\", \"toolkit/components/contentprefs/tests/unit_cps2/xpcshell.ini\", \"toolkit/components/contextualidentity/tests/unit/xpcshell.ini\", \"toolkit/components/corroborator/test/xpcshell/xpcshell.ini\", \"toolkit/components/crashes/tests/xpcshell/xpcshell.ini\", \"toolkit/components/crashmonitor/test/unit/xpcshell.ini\", \"toolkit/components/enterprisepolicies/tests/xpcshell/xpcshell.ini\", \"toolkit/components/extensions/test/xpcshell/native_messaging.ini\", \"toolkit/components/extensions/test/xpcshell/xpcshell-e10s.ini\", \"toolkit/components/extensions/test/xpcshell/xpcshell-legacy-ep.ini\", \"toolkit/components/extensions/test/xpcshell/xpcshell.ini\", \"toolkit/components/featuregates/test/unit/xpcshell.ini\", \"toolkit/components/filewatcher/tests/xpcshell/xpcshell.ini\", \"toolkit/components/forgetaboutsite/test/unit/xpcshell.ini\", \"toolkit/components/kvstore/test/xpcshell/xpcshell.ini\", \"toolkit/components/mediasniffer/test/unit/xpcshell.ini\", \"toolkit/components/messaging-system/targeting/test/unit/xpcshell.ini\", \"toolkit/components/normandy/test/unit/xpcshell.ini\", \"toolkit/components/passwordmgr/test/unit/xpcshell.ini\", \"toolkit/components/places/tests/favicons/xpcshell.ini\", \"toolkit/components/places/tests/legacy/xpcshell.ini\", \"toolkit/components/places/tests/migration/xpcshell.ini\", \"toolkit/components/places/tests/queries/xpcshell.ini\", \"toolkit/components/places/tests/unit/xpcshell.ini\", \"toolkit/components/processtools/tests/xpcshell/xpcshell.ini\", \"toolkit/components/reputationservice/test/unit/xpcshell.ini\", \"toolkit/components/satchel/test/unit/xpcshell.ini\", \"toolkit/components/search/tests/xpcshell/searchconfigs/xpcshell.ini\", \"toolkit/components/startup/tests/unit/xpcshell.ini\", \"toolkit/components/terminator/tests/xpcshell/xpcshell.ini\", \"toolkit/components/timermanager/tests/unit/xpcshell.ini\", \"toolkit/components/url-classifier/tests/unit/xpcshell.ini\", \"toolkit/content/tests/unit/xpcshell.ini\", \"toolkit/crashreporter/test/unit_ipc/xpcshell.ini\", \"toolkit/modules/subprocess/test/xpcshell/xpcshell.ini\", \"toolkit/modules/tests/xpcshell/xpcshell.ini\", \"toolkit/mozapps/extensions/test/xpcshell/rs-blocklist/xpcshell.ini\", \"toolkit/mozapps/extensions/test/xpcshell/xpcshell.ini\", \"toolkit/mozapps/update/tests/unit_background_update/xpcshell.ini\", \"toolkit/mozapps/update/tests/unit_base_updater/xpcshell.ini\", \"tools/code-coverage/tests/xpcshell/xpcshell.ini\", \"tools/profiler/tests/xpcshell/xpcshell.ini\", \"widget/headless/tests/xpcshell.ini\"]}"
          EXTRA_MOZHARNESS_CONFIG: "{\"installer_url\": \"https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/bln2lzFhRF6iw5AV8cZg9w/artifacts/public/build/target.zip\", \"test_packages_url\": \"https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/VCHd7SmcQhWaQix7Gh4taQ/artifacts/public/build/target.test_packages.json\"}"
        run: |
          C:/mozilla-build/python3/python3.exe run-task -- c:\mozilla-build\python\python.exe -u mozharness\scripts\desktop_unittest.py --cfg mozharness\configs\unittests\win_unittest.py --xpcshell-suite=xpcshell --setpref=media.peerconnection.mtransport_process=false --setpref=network.process.enabled=false --download-symbols true
  debug-xpcshell-e10s-2:
    runs-on: windows-2019
    steps:
      - uses: actions/checkout@v2
      - name: mounts
        run: |
          curl -L https://hg.mozilla.org/try/raw-file/45c659bd4922fa3b4a7b602c6214f16092a31284/taskcluster/scripts/misc/fetch-content --output fetch-content
          curl -L https://hg.mozilla.org/try/raw-file/45c659bd4922fa3b4a7b602c6214f16092a31284/taskcluster/scripts/run-task --output run-task
          curl -L https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/VCHd7SmcQhWaQix7Gh4taQ/artifacts/public/build/mozharness.zip --output mozharness.zip
          7z x -omozharness mozharness.zip
      - name: dependencies
        run: |
          python -m pip install --upgrade zstandard
          python -m pip install --upgrade certifi
      - name: test
        env:
          TASKCLUSTER_ROOT_URL: https://firefox-ci-tc.services.mozilla.com
          PYTHON: C:\hostedtoolcache\windows\Python\3.7.9\x64\python.exe
          MOZ_FETCHES: "[{\"artifact\": \"public/build/fix-stacks.tar.bz2\", \"extract\": true, \"task\": \"Lhs91AvoT-28yyuTcna2Gw\"}, {\"artifact\": \"public/build/minidump_stackwalk.tar.xz\", \"extract\": true, \"task\": \"IGMuVbTvSiafcP8RW2xM-g\"}, {\"artifact\": \"public/build/node.tar.zst\", \"extract\": true, \"task\": \"Du1bGczPTLGc2XKvucvs1Q\"}]"
          MOZ_SCM_LEVEL: "3"
          GECKO_HEAD_REV: "45c659bd4922fa3b4a7b602c6214f16092a31284"
          MOZ_AUTOMATION: "1"
          MOZ_FETCHES_DIR: "fetches"
          SCCACHE_DISABLE: "1"
          GECKO_HEAD_REPOSITORY: "https://hg.mozilla.org/mozilla-central"
          MOZHARNESS_TEST_PATHS: "{\"xpcshell\": [\"browser/components/about/test/unit/xpcshell.ini\", \"browser/components/aboutlogins/tests/unit/xpcshell.ini\", \"browser/components/attribution/test/xpcshell/xpcshell.ini\", \"browser/components/downloads/test/unit/xpcshell.ini\", \"browser/components/extensions/test/xpcshell/xpcshell.ini\", \"browser/components/installerprefs/test/unit/xpcshell.ini\", \"browser/components/newtab/test/xpcshell/xpcshell.ini\", \"browser/components/search/test/unit/xpcshell.ini\", \"browser/components/sessionstore/test/unit/xpcshell.ini\", \"browser/components/syncedtabs/test/xpcshell/xpcshell.ini\", \"browser/components/tests/unit/xpcshell.ini\", \"browser/components/translation/test/unit/xpcshell.ini\", \"browser/extensions/formautofill/test/unit/xpcshell.ini\", \"browser/modules/test/unit/xpcshell.ini\", \"chrome/test/unit/xpcshell.ini\", \"chrome/test/unit_ipc/xpcshell.ini\", \"devtools/client/application/test/xpcshell/xpcshell.ini\", \"devtools/client/inspector/changes/test/xpcshell/xpcshell.ini\", \"devtools/client/inspector/compatibility/test/xpcshell/xpcshell.ini\", \"devtools/client/inspector/grids/test/xpcshell/xpcshell.ini\", \"devtools/client/memory/test/xpcshell/xpcshell.ini\", \"devtools/client/netmonitor/test/xpcshell/xpcshell.ini\", \"devtools/client/performance-new/test/xpcshell/xpcshell.ini\", \"devtools/server/tests/xpcshell/xpcshell.ini\", \"devtools/shared/acorn/tests/xpcshell/xpcshell.ini\", \"devtools/shared/discovery/tests/xpcshell/xpcshell.ini\", \"devtools/shared/protocol/tests/xpcshell/xpcshell.ini\", \"devtools/shared/webconsole/test/xpcshell/xpcshell.ini\", \"dom/abort/tests/unit/xpcshell.ini\", \"dom/base/test/unit/xpcshell.ini\", \"dom/file/tests/xpcshell.ini\", \"dom/ipc/tests/xpcshell.ini\", \"dom/localstorage/test/unit/xpcshell.ini\", \"dom/media/webvtt/test/xpcshell/xpcshell.ini\", \"dom/notification/test/unit/xpcshell.ini\", \"dom/push/test/xpcshell/xpcshell.ini\", \"dom/quota/test/xpcshell/upgrades/xpcshell.ini\", \"dom/quota/test/xpcshell/xpcshell.ini\", \"dom/workers/test/xpcshell/xpcshell.ini\", \"extensions/permissions/test/unit/xpcshell.ini\", \"intl/l10n/test/xpcshell.ini\", \"intl/locale/tests/unit/xpcshell.ini\", \"intl/strres/tests/unit/xpcshell.ini\", \"js/ductwork/debugger/tests/xpcshell.ini\", \"js/xpconnect/tests/unit/xpcshell.ini\", \"memory/replace/dmd/test/xpcshell.ini\", \"modules/libjar/zipwriter/test/unit/xpcshell.ini\", \"modules/libmar/tests/unit/xpcshell.ini\", \"modules/libpref/test/unit_ipc/xpcshell.ini\", \"netwerk/dns/tests/unit/xpcshell.ini\", \"netwerk/test/httpserver/test/xpcshell.ini\", \"netwerk/test/unit_ipc/xpcshell.ini\", \"parser/xml/test/unit/xpcshell.ini\", \"remote/cdp/test/xpcshell/xpcshell.ini\", \"security/manager/ssl/tests/unit/xpcshell.ini\", \"services/crypto/tests/unit/xpcshell.ini\", \"services/fxaccounts/tests/xpcshell/xpcshell.ini\", \"services/settings/test/unit/xpcshell.ini\", \"storage/test/unit/xpcshell.ini\", \"testing/marionette/test/unit/xpcshell.ini\", \"testing/modules/tests/xpcshell/xpcshell.ini\", \"testing/xpcshell/example/unit/xpcshell.ini\", \"toolkit/components/aboutmemory/tests/xpcshell/xpcshell.ini\", \"toolkit/components/backgroundtasks/tests/xpcshell/xpcshell.ini\", \"toolkit/components/cascade_bloom_filter/test/xpcshell/xpcshell.ini\", \"toolkit/components/cloudstorage/tests/unit/xpcshell.ini\", \"toolkit/components/commandlines/test/unit/xpcshell.ini\", \"toolkit/components/ctypes/tests/unit/xpcshell.ini\", \"toolkit/components/downloads/test/unit/xpcshell.ini\", \"toolkit/components/extensions/test/xpcshell/xpcshell-remote.ini\", \"toolkit/components/glean/xpcshell/xpcshell.ini\", \"toolkit/components/lz4/tests/xpcshell/xpcshell.ini\", \"toolkit/components/mozintl/test/xpcshell.ini\", \"toolkit/components/nimbus/test/unit/xpcshell.ini\", \"toolkit/components/osfile/tests/xpcshell/xpcshell.ini\", \"toolkit/components/places/tests/bookmarks/xpcshell.ini\", \"toolkit/components/places/tests/expiration/xpcshell.ini\", \"toolkit/components/places/tests/history/xpcshell.ini\", \"toolkit/components/places/tests/maintenance/xpcshell.ini\", \"toolkit/components/places/tests/sync/xpcshell.ini\", \"toolkit/components/places/tests/unifiedcomplete/xpcshell.ini\", \"toolkit/components/promiseworker/tests/xpcshell/xpcshell.ini\", \"toolkit/components/search/tests/xpcshell/xpcshell.ini\", \"toolkit/components/taskscheduler/tests/xpcshell/xpcshell.ini\", \"toolkit/components/telemetry/tests/unit/xpcshell.ini\", \"toolkit/components/thumbnails/test/xpcshell.ini\", \"toolkit/components/urlformatter/tests/unit/xpcshell.ini\", \"toolkit/components/utils/test/unit/xpcshell.ini\", \"toolkit/components/windowcreator/tests/unit/xpcshell.ini\", \"toolkit/components/xulstore/tests/xpcshell/xpcshell.ini\", \"toolkit/crashreporter/test/unit/xpcshell-phc.ini\", \"toolkit/crashreporter/test/unit/xpcshell.ini\", \"toolkit/crashreporter/test/unit_ipc/xpcshell-phc.ini\", \"toolkit/mozapps/downloads/tests/unit/xpcshell.ini\", \"toolkit/mozapps/extensions/test/xpcshell/xpcshell-unpack.ini\", \"toolkit/mozapps/update/tests/unit_aus_update/xpcshell.ini\", \"toolkit/mozapps/update/tests/unit_service_updater/xpcshell.ini\", \"toolkit/profile/xpcshell/xpcshell.ini\", \"toolkit/xre/test/xpcshell.ini\", \"uriloader/exthandler/tests/unit/xpcshell.ini\", \"widget/tests/unit/xpcshell.ini\", \"xpcom/tests/unit/xpcshell.ini\"]}"
          EXTRA_MOZHARNESS_CONFIG: "{\"installer_url\": \"https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/bln2lzFhRF6iw5AV8cZg9w/artifacts/public/build/target.zip\", \"test_packages_url\": \"https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/VCHd7SmcQhWaQix7Gh4taQ/artifacts/public/build/target.test_packages.json\"}"
        run: |
          C:/mozilla-build/python3/python3.exe run-task -- c:\mozilla-build\python\python.exe -u mozharness\scripts\desktop_unittest.py --cfg mozharness\configs\unittests\win_unittest.py --xpcshell-suite=xpcshell --setpref=media.peerconnection.mtransport_process=false --setpref=network.process.enabled=false --download-symbols true
